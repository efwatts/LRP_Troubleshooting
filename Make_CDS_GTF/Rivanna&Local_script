#for Rivanna 
module load apptainer/1.2.2
module load gcc/11.4.0  
module load openmpi/4.1.4
module load python/3.11.4
module load bioconda/py3.10

#create the custom conda environment for this script
conda env create -f environment.yml

#pull the Docker using Apptainer, because isn't working on my machine or HPC
apptainer pull pb-cds_gtf.sif docker://gsheynkmanlab/pb-cds-gtf:latest

#activate conda env
conda activate reference-tables
mamba install gtfparse

##ADD DIRECTORY TO APPTAINER SCRATCH
apptainer exec --bind $SCRATCH:/scratch/yqy3cu/ORF_docker/CDS_GTF pb-cds.gtf.sif ls /scratch

#Check that it is in scratch
apptainer exec pb-cds_gtf.sif ls $SCRATCH

#now enter the container
apptainer exec pb-cds_gtf.sif /bin/bash


python /scratch/yqy3cu/ORF_docker/CDS_GTF/make_pacbio_cds_gtf.py \
--sample_gtf /scratch/yqy3cu/LRP_tutorial/IsoSeqSQANTI/toy/collapse/merged.collapsed.gff \
--agg_orfs /scratch/yqy3cu/ORF_docker/Refine/jurkat_30_orf_refined.tsv \
--refined_orfs /scratch/yqy3cu/ORF_docker/jurkat_cpat.ORF_called.tsv \
--pb_gene /scratch/yqy3cu/ORF_docker/pb_gene.tsv \
--output_cds /scratch/yqy3cu/ORF_docker/CDS_GTF/toy_cds.gtf


#Samer errors across all methods so I'm going to troubleshoot on my machine
cd /Users/emilywatts/Library/CloudStorage/OneDrive-UniversityofVirginia/Docker/ORF_Docker/cds_gtf_files

conda env create -f environment.yml
conda activate reference-tables

python make_pacbio_cds_gtf.py \
--sample_gtf merged.collapsed.gff \
--agg_orfs jurkat_30_orf_refined.tsv \
--refined_orfs jurkat_cpat.ORF_called.tsv \
--pb_gene pb_gene.tsv \
--output_cds toy_cds.gtf

##weird...on my machine, I get this error: TypeError: cannot use `__getitem__` on DataFrame with item shape: (268,)
##Series: 'feature' [bool]



